# 5장. 도메인 특화 설계 (표준 확장하기 ~)

### 의미 체계의 문제 맞닥뜨리기

특정 도메인을 위한 API 설계자에게 의미적 차이를 이어주는 것은 두 단계의 과정입니다.

1. 사람이 읽을 수 있는 규격으로 애플리케이션 의미 체계 작성하기.
2. 설계의 따라 하나 이상의 IANA 미디어 유형 등록하기. 등록할 때 미디어 유형과 작성한 사람이 읽을 수 있는 문서 연계.

클라이언트 개발자는 이 의미적 차이를 뛰어넘기 위해 이 과정을 반대로 진행합니다.

1. 모르는 미디어 유형을 IANA 등록부에서 검색.
2. 모르는 미디어 유형의 문서를 어떻게 다뤄야 할지 사람이 읽을 수 있는 규격을 통해 학습.

<br/>

### 도메인 특화 설계를 찾을 수 없다면 만들지 말라

문제 도메인을 위한 도메인 특화 API를 찾을 수 없더라도, 새로 만드는 것보다 기존에 표준화된 기반으로부터 시작해 확장해서 사용하는 것이 좋습니다.

(다음 두 장에 걸쳐 이러한 방식을 설명한다고 합니다.)

<br/>

### API 클라이언트의 종류

**사람이 조종하는 클라이언트**

사람이 조종하는 클라이언트는 의사 결정을 할 필요가 없으므로 상대적으로 로직이 간단합니다.

사람에게 표현을 제시하고, 사람의 결정을 서버에 전달합니다. 따라서 사용자에게 가능한 동작들을 얼마나 잘 표시하는지가 중요합니다.

ex) 웹 브라우저

**자동 클라이언트**

자동 클라이언트는 렌더링을 볼 사람이 없기 때문에 표현을 받아도 렌더링하지 않습니다.

이 클라이언트들은 어떤 하이퍼미디어 컨트롤을 동작시킬 지 결정하고 수행해야합니다.

**크롤러**

URL이 주어지면 데이터를 가져오고, 그후 모든 링크를 따라가며 더 이상 가져올 것이 없을 때까지 계속 데이터를 가져옵니다.

일반적으로 크롤러는 안전한 상태 전이만 활성화합니다. 만약 크롤러가 만나는 리소스마다 DELETE 요청을 날린다면? 😵

ex) 책에서 예제로 나온 지도 제작 클라이언트

**모니터**

모니터는 크롤러의 반대입니다. URL이 주어지면 해당 URL의 데이터를 가져오지만, 링크를 따라가진 않고 잠시 기다린 뒤 다시 동일한 리소스의 새 데이터를 가져옵니다.

즉, 하이퍼미디어 컨트롤을 사용해 리소스 상태를 변화시키는 대신 누군가 리소스 상태를 변화시키길 기다리고, 이후 무슨 일이 생겼는지 확인합니다.

**스크립트**

오늘날 대다수의 자동 API 클라이언트는 스크립트입니다. 스크립트는 변하지 않는 특정 작업 루틴을 계속 수행합니다.

대부분의 스크립트는 서버에서 전달되는 데이터나 구조가 바뀐다면 보통 고장나게 됩니다.

ex) 책에서 예제로 나온 허풍쟁이 클라이언트

**에이전트**

에이전트는 서버에서 받는 표현에 맞춰 매번 행동을 변화시킵니다.

주어진 데이터를 보고,상황을 분석한 뒤 어떤 하이퍼미디어 컨트롤을 활성화하는 것이 최종 목표에 더 가까워지게 할지를 결정합니다.

ex) http://amundsen.com/examples/misc/maze-client.html

<br/>

## Q&A

**Q1.**
> 만약 Maze+XML의 이동에 대각선 방향 이동을 지원하도록 확장한다면 클라이언트는
>
> - 기존 동서남북 방향 이동만 지원했을때와 동일하게 파싱할 수 있을까요?
> - 또한 이때 지도 제작기 클라이언트는 어떤 문제를 가지게 되고 이는 어떻게 해결할 수 있을까요?
>    
> `by 서형석`

**A1.**

- 기존 동서남북 방향만 지원하는 클라이언트는 rel 속성에 새로운 방향 값을 처리할 수 없는 경우가 많습니다.
  
  이를 해결하려며, 기존 방향 외에 대각선 값을 추가하더라도 문제가 없도록 역호환성 로직을 추가하거나, 새 방향 값을 사용하지 않도록 XML 파일에서 처리하거나 별도의 방식으로 지원하는 등 클라이언트 측의 처리가 필요합니다.

- 지도 제작기 클라이언트에서 발생할 수 있는 문제는 다음과 같습니다.
  - 지도 시각화 및 데이터 구조 변경
    
    대각선 이동은 단순한 동서남북 이동보다 시각적으로 복잡한 경로를 나타냅니다. 기존의 시각화 로직이 직선 경로만 가정했다면, 대각선 경로를 표시하는 데 문제가 발생할 수 있습니다.

  - 기존 클라이언트와의 호환성
    
    기존 클라이언트가 동서남북 방향만 지원하는 경우, 대각선 이동을 포함한 XML 파일을 로드할 때 문제를 일으킬 수 있습니다. 이를 해결하려면,
    
    1. 버전 관리
       예를들어 XML의 <maze> 태그에 version 속성을 추가하여 새로운 방향을 포함한 데이터를 기존 클라이언트가 인식하지 않도록 분리합니다.

       예: `<maze version="2.0">`로 새 방향 포함 여부를 명시하기

    2. 대각선 이동의 변환 처리
       기존 지도 제작기에서 대각선 이동을 동서남북 방향으로 변환하여 처리합니다.

       예를들어 NE → N, E의 연속 이동으로 변환합니다. 단, 이 경우 경로의 원래 의도가 왜곡될 수 있습니다.

  - 대각선 방향으로의 이동을 고려한 경로 탐색 알고리즘의 수정이 필요합니다.

<br/>

**Q2.**
> 도메인 특화 설계 중 maze+xml에 더해 voice xml(vxml)이 대표적이던데 vxml에 대해 간략히 설명해주세요
>
> `by 최준영`

**A2.**

VoiceXML(VXML)은 인간과 컴퓨터 간의 대화형 미디어 및 음성 대화를 지정하기 위한 디지털 문서 표준입니다.

이는 은행 시스템 및 자동화된 고객 서비스 포털과 같은 오디오 및 음성 응답 애플리케이션을 개발하는 데 사용됩니다.

[문서](https://www.w3.org/TR/voicexml20/)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<vxml xmlns="http://www.w3.org/2001/vxml" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xsi:schemaLocation="http://www.w3.org/2001/vxml 
   http://www.w3.org/TR/voicexml20/vxml.xsd"
   version="2.0">
 <meta name="author" content="John Doe"/>
 <meta name="maintainer" content="hello-support@hi.example.com"/>
 <var name="hi" expr="'Hello World!'"/>
 <form>
  <block>
     <value expr="hi"/>
     <goto next="#say_goodbye"/>
  </block>
 </form>
 <form id="say_goodbye">
  <block>
     Goodbye!
  </block>
 </form>
</vxml>
```

<br/>

**Q3.**
> hCard로 소개된 마이크로포맷이 특정 정보를 유용하게 나타낼 수 있을 것으로 보이는데,
>
> 1. 마이크로포맷을 사용하려면 책에 나와있는 <div class="vcard">처럼 직접 형식을 명시해줘야 하는 건지, 혹은 변환할 수 있는 기능이 있는지 궁금합니다
> 2. 실제 마이크로포맷이 사용되고 있는 페이지를 소개해주세요
>
> `by 한태혁`

**A3.**

1. hCard로 동작하려면 반드시 클래스 속성을 통해 데이터의 의미를 명시해야 합니다.
   
   만약 클래스 속성을 사용하지 않는다면, hCard의 데이터를 검색 엔진, 데이터 크롤러 등이 인식하지 못합니다.

   HTML의 다른 속성을 사용하더라도 마이크로포맷의 표준 규격을 벗어나기 때문에 hCard로 간주되지 않습니다.
   
2. 요즘은 잘 사용하지 않는 것 같습니다..
   
   대신 요즘에는 `Schema.org + JSON-LD` 데이터 표준을 많이 사용한다고 합니다.
   
```html
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "John Doe",
  "jobTitle": "CEO",
  "worksFor": {
    "@type": "Organization",
    "name": "Acme Corporation"
  }
}
</script>
```


<br/>

**Q4.**
> Maze+XML 과 달리 표준 확장을 허용하지 않는 표준은 어떤 것들이 있나요?
>
> `by 박근영`

**A4.**

1. 특정 표준에 고정된 미디어 타입

- `application/json`
  
JSON 형식은 [RFC 8259](https://datatracker.ietf.org/doc/html/rfc8259)에 따라 엄격하게 정의되어 있습니다. 대신, JSON 기반의 확장은 파일 내에서 특정 스키마나 구조를 정의하여 이루어집니다.

- `text/html`
  
HTML은 W3C 표준을 따르며, 확장이 필요할 경우 HTML 표준 자체가 업데이트됩니다. 미디어 타입 수준에서는 확장을 허용하지 않습니다.

2. 보안적 이유로 확장을 허용하지 않는 타입
   
- `application/octet-stream`
  
이 미디어 타입은 기본적으로 바이너리 데이터를 위한 범용 타입으로, 명시적인 목적이 없으므로 확장을 허용하지 않습니다.

- `application/x-www-form-urlencoded`
 
이 타입은 HTTP 폼 데이터 전송을 위해 엄격하게 정의된 포맷을 사용하며, 확장을 허용하지 않습니다.

3. 의미적으로 고정된 타입
   
- `image/png`, `image/jpeg`
  
이미지 포맷의 경우 포맷 자체가 고정되어 있으므로, 미디어 타입 차원에서 확장을 허용하지 않습니다.
